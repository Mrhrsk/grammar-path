<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GrammarPath: Complete English Curriculum Designer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Chart Container */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) { .chart-container { height: 350px; } }

        /* Interactivity */
        .topic-card { transition: all 0.2s ease-in-out; }
        .topic-card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }

        /* Tabs */
        .tab-active { border-bottom: 3px solid #475569; color: #1e293b; font-weight: 600; }
        .tab-inactive { color: #64748b; border-bottom: 3px solid transparent; }
        .tab-inactive:hover { color: #334155; border-bottom: 3px solid #cbd5e1; }

        /* AI Content Styling */
        .ai-content { line-height: 1.7; color: #334155; }
        .ai-content h3 { font-size: 1.25rem; font-weight: 700; color: #1e293b; margin-top: 1.5rem; margin-bottom: 0.75rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.25rem; }
        .ai-content h4 { font-size: 1.1rem; font-weight: 600; color: #475569; margin-top: 1rem; margin-bottom: 0.5rem; }
        .ai-content p { margin-bottom: 1rem; }
        .ai-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1rem; }
        .ai-content ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1rem; }
        .ai-content li { margin-bottom: 0.5rem; }
        .ai-content strong { color: #4338ca; font-weight: 600; }
    </style>
</head>
<body class="bg-stone-50 text-slate-800 font-sans min-h-screen flex flex-col">

<!-- Header -->
<header class="bg-white border-b border-stone-200 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
                <span class="text-2xl font-bold text-slate-700 tracking-tight">GrammarPath</span>
                <span class="ml-3 px-2 py-1 bg-stone-100 text-xs font-medium text-stone-600 rounded">Teacher's Edition</span>
            </div>
            <div class="hidden md:flex space-x-8">
                <button onclick="app.showSection('curriculum')" class="text-slate-600 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">Curriculum</button>
                <button onclick="app.showSection('roadmap')" class="text-slate-600 hover:text-slate-900 px-3 py-2 rounded-md text-sm font-medium">Global Roadmap</button>
            </div>
        </div>
    </div>
</header>

<!-- Main -->
<main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
    <div class="mb-10 text-center max-w-3xl mx-auto">
        <h1 class="text-3xl font-bold text-slate-800 mb-4">A Progressive English Grammar Curriculum</h1>
        <p class="text-lg text-slate-600">
            This interactive guide outlines the optimal sequence for teaching English grammar.
            Starting from absolute zero (A1) to near-native proficiency (C2).
        </p>
    </div>

    <div id="view-curriculum" class="space-y-6">
        <div class="border-b border-stone-200">
            <nav class="-mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
                <button onclick="app.loadLevel('A1')" id="tab-A1" class="tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center">A1: Starter</button>
                <button onclick="app.loadLevel('A2')" id="tab-A2" class="tab-inactive whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center">A2: Elementary</button>
                <button onclick="app.loadLevel('B1')" id="tab-B1" class="tab-inactive whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center">B1: Intermediate</button>
                <button onclick="app.loadLevel('B2')" id="tab-B2" class="tab-inactive whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center">B2: Upper Int</button>
                <button onclick="app.loadLevel('C1')" id="tab-C1" class="tab-inactive whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center">C1: Advanced</button>
                <button onclick="app.loadLevel('C2')" id="tab-C2" class="tab-inactive whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center">C2: Mastery</button>
            </nav>
        </div>
        <div id="level-content" class="animate-fade-in"></div>
    </div>

    <div id="view-roadmap" class="hidden">
        <div class="bg-white rounded-lg shadow-sm p-6 border border-stone-200">
            <h2 class="text-2xl font-bold text-slate-800 mb-4">The Complexity Ascent</h2>
            <div class="chart-container"><canvas id="roadmapChart"></canvas></div>
        </div>
    </div>
</main>

<!-- Modal -->
<div id="topic-modal" class="fixed inset-0 bg-slate-900 bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto transform transition-all flex flex-col">
        <div class="p-6 flex-grow overflow-y-auto">
            <div class="flex justify-between items-start">
                <div>
                    <span id="modal-category" class="inline-block px-2 py-1 text-xs font-semibold rounded bg-blue-100 text-blue-800 mb-2">Category</span>
                    <h3 id="modal-title" class="text-2xl font-bold text-slate-900">Topic Title</h3>
                </div>
                <button onclick="app.closeModal()" class="text-slate-400 hover:text-slate-500 text-2xl font-bold">&times;</button>
            </div>

            <div class="mt-6 space-y-6">
                <div>
                    <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide">Concept Summary</h4>
                    <p id="modal-desc" class="mt-2 text-slate-700 leading-relaxed"></p>
                </div>

                <!-- PDF Link -->
                <div id="pdf-resource-section" class="bg-amber-50 p-4 rounded-md border border-amber-100 flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">üìÑ</span>
                        <div>
                            <h4 class="text-sm font-bold text-amber-900 uppercase tracking-wide">Presentation Material</h4>
                            <p id="pdf-status-text" class="text-sm text-amber-800">Available for download</p>
                        </div>
                    </div>
                    <a id="pdf-link-btn" href="#" target="_blank" class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700 transition-colors text-sm font-medium shadow-sm">Open PDF</a>
                    <span id="pdf-missing-badge" class="hidden px-3 py-1 bg-stone-200 text-stone-500 rounded text-sm font-medium">No corresponding presentation</span>
                </div>

                <div class="bg-stone-50 p-4 rounded-md border border-stone-200">
                    <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-2">Key Examples</h4>
                    <ul id="modal-examples" class="list-disc list-inside text-slate-700 space-y-1"></ul>
                </div>

                <div class="bg-indigo-50 p-4 rounded-md border border-indigo-100">
                    <h4 class="text-sm font-bold text-indigo-800 uppercase tracking-wide mb-2">Teacher's Tip</h4>
                    <p id="modal-tip" class="text-indigo-900 text-sm"></p>
                </div>

                <!-- AI Section -->
                <div class="mt-6 border-t border-stone-200 pt-6">
                    <h4 class="text-sm font-bold text-slate-500 uppercase tracking-wide mb-3 flex items-center gap-2">
                        <span>AI Assistant</span>
                        <span class="px-2 py-0.5 rounded-full bg-purple-100 text-purple-700 text-xs font-medium">Gemini Powered</span>
                    </h4>
                    <div class="flex flex-wrap gap-3">
                        <button onclick="app.generateLessonPlan()" id="btn-lesson-plan" class="flex items-center gap-2 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 transition-colors text-sm font-medium shadow-sm">
                            <span>‚ú® Generate Lesson Plan</span>
                        </button>
                        <button onclick="app.generateMoreExamples()" id="btn-examples" class="flex items-center gap-2 px-4 py-2 bg-white border border-stone-300 text-slate-700 rounded-md hover:bg-stone-50 transition-colors text-sm font-medium shadow-sm">
                            <span>‚ú® Get More Examples</span>
                        </button>
                    </div>

                    <div id="ai-output" class="mt-4 hidden animate-fade-in">
                        <div id="ai-loading" class="flex items-center gap-2 text-slate-500 text-sm italic p-4 bg-stone-50 rounded-md border border-stone-200">
                            <div class="animate-spin h-4 w-4 border-2 border-purple-500 border-t-transparent rounded-full"></div>
                            <span id="ai-loading-text">Consulting the AI...</span>
                        </div>
                        <div id="ai-content-box" class="hidden">
                            <div id="ai-content" class="ai-content bg-white p-6 rounded-md border border-purple-200 shadow-inner"></div>
                        </div>
                        <div id="ai-error" class="hidden text-red-600 text-sm p-4 bg-red-50 rounded-md border border-red-200 mt-2"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="p-6 border-t border-stone-100 bg-stone-50 rounded-b-lg flex justify-end">
            <button onclick="app.closeModal()" class="px-4 py-2 bg-white border border-stone-300 text-slate-700 rounded hover:bg-stone-50 transition-colors font-medium">Close</button>
        </div>
    </div>
</div>

<footer class="bg-stone-100 border-t border-stone-200 mt-12 py-8">
    <div class="max-w-7xl mx-auto px-4 text-center text-slate-500 text-sm">
        <p>&copy; 2023 GrammarPath. Designed for EFL/ESL Educators.</p>
    </div>
</footer>

<script>
    // ‚¨áÔ∏è –í–°–¢–ê–í–¨–¢–ï –í–ê–® –ö–õ–Æ–ß –°–Æ–î–ê (–¢–û–õ–¨–ö–û –ú–ï–ñ–î–£ –ö–ê–í–´–ß–ö–ê–ú–ò) ‚¨áÔ∏è
    const apiKey = "";

    // --- –§–£–ù–ö–¶–ò–Ø –ó–ê–ü–†–û–°–ê –ö AI (–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û –ù–ê–î–ï–ñ–ù–ê–Ø) ---
    async function callGemini(prompt, systemInstruction = "") {
        const modelsToTry = ["gemini-1.5-flash", "gemini-1.5-flash-001", "gemini-pro"];
        const key = apiKey.trim();

        if (!key) throw new Error("–ù–µ—Ç API –∫–ª—é—á–∞!");

        for (const model of modelsToTry) {
            console.log(`–ü—Ä–æ–±—É–µ–º –º–æ–¥–µ–ª—å: ${model}...`);
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${key}`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        systemInstruction: { parts: [{ text: systemInstruction }] }
                    })
                });

                if (response.status === 404) continue; // –ú–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â—É—é
                if (!response.ok) throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || "–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç AI.";
            } catch (e) {
                if (model === modelsToTry[modelsToTry.length - 1]) throw e;
            }
        }
    }

    // --- –ü–†–û–°–¢–û–ô –§–û–†–ú–ê–¢–¢–ï–† (–¢–ï–ö–°–¢ -> –ß–ò–¢–ê–ï–ú–´–ô –í–ò–î) ---
    // –ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤ –æ—Ç—Å—Ç—É–ø—ã, –∞ –∑–≤–µ–∑–¥–æ—á–∫–∏ –≤ –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç. –ù–∏–∫–∞–∫–∏—Ö —Å–ª–æ–∂–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü.
    function formatSimpleText(text) {
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
            .replace(/\n/g, '<br>'); // –ü–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
    }

    // --- –î–ê–ù–ù–´–ï (–í–ê–®–ò PDF –°–°–´–õ–ö–ò –°–û–•–†–ê–ù–ï–ù–´) ---
    const grammarData = {
        'A1': {
            title: "The Foundation",
            desc: "Focus on survival English.",
            topics: [
                { id: 'a1_1', title: "Personal Pronouns & To Be", category: "Structure", desc: "I, You, He, She, It. To be.", examples: ["I am a teacher."], tip: "Use gestures." },
                { id: 'a1_2', title: "Articles: A / An / The", category: "Nouns", desc: "Indefinite vs Definite.", examples: ["It is a cat."], tip: "Start with a/an." },
                { id: 'a1_3', title: "Plural Nouns", category: "Nouns", desc: "Adding -s/-es.", examples: ["Two dogs."], tip: "Pronunciation of 's'." },
                { id: 'a1_4', title: "Demonstratives", category: "Determiners", desc: "This/That.", examples: ["This book."], tip: "Distance." },
                { id: 'a1_5', title: "Possessive Adjectives", category: "Adjectives", desc: "My, Your, His.", examples: ["My pen."], tip: "Contrast with pronouns." },
                { id: 'a1_6', title: "Present Simple (+)", category: "Tenses", desc: "Facts/Habits.", examples: ["I like pizza."], tip: "3rd person 's'." },
                { id: 'a1_7', title: "Present Simple (-/?)", category: "Tenses", desc: "Do/Does.", examples: ["I don't know."], tip: "Base verb form." },
                { id: 'a1_8', title: "Prepositions of Place", category: "Prepositions", desc: "In, On, Under.", examples: ["On the table."], tip: "Use real objects." },
                { id: 'a1_9', title: "There is / There are", category: "Structure", desc: "Existence.", examples: ["There is a pen."], tip: "Connect with prepositions." },
                { id: 'a1_10', title: "Can / Can't", category: "Modals", desc: "Ability.", examples: ["I can swim."], tip: "No change for He/She." }
            ]
        },
        'A2': {
            title: "Expanding Horizons",
            desc: "Past and Future.",
            topics: [
                { id: 'a2_1', title: "Past Simple (To Be)", category: "Tenses", desc: "Was/Were.", examples: ["I was tired."], tip: "Teach before regular verbs." },
                { id: 'a2_2', title: "Past Simple (Regular)", category: "Tenses", desc: "-ed endings.", examples: ["Played."], tip: "-ed pronunciation." },
                { id: 'a2_3', title: "Past Simple (Irregular)", category: "Tenses", desc: "Go-Went.", examples: ["Went."], tip: "Group by sound." },
                { id: 'a2_4', title: "Countable/Uncountable", category: "Nouns", desc: "Much/Many.", examples: ["Water vs Apple."], tip: "Food items." },
                { id: 'a2_5', title: "Comparatives", category: "Adjectives", desc: "Faster than.", examples: ["Bigger."], tip: "Irregulars." },
                { id: 'a2_6', title: "Present Continuous", category: "Tenses", desc: "Now.", examples: ["Eating."], tip: "Timelines." },
                { id: 'a2_7', title: "Going to", category: "Tenses", desc: "Plans.", examples: ["Going to buy."], tip: "Plans vs Spontaneous." },
                { id: 'a2_8', title: "Adverbs of Frequency", category: "Adverbs", desc: "Always/Never.", examples: ["Always."], tip: "Position." },
                { id: 'a2_9', title: "Possessive 's", category: "Nouns", desc: "John's car.", examples: ["John's."], tip: "Not plural." },
                { id: 'a2_10', title: "Prepositions of Time", category: "Prepositions", desc: "In/On/At.", examples: ["On Monday."], tip: "Pyramid visual." }
            ]
        },
        'B1': {
            title: "The Bridge to Fluency",
            desc: "Connecting ideas.",
            topics: [
                { id: 'b1_1', title: "Present Perfect", category: "Tenses", desc: "Experiences.", examples: ["Have been."], tip: "Contrast with Past Simple." },
                { id: 'b1_2', title: "For vs Since", category: "Prepositions", desc: "Duration.", examples: ["For 2 years."], tip: "Link to Pres. Perf." },
                { id: 'b1_3', title: "Zero & First Conditional", category: "Structure", desc: "If... will.", examples: ["If it rains..."], tip: "Structure.", pdf: "https://drive.google.com/file/d/1WOqqSp_Ndw3GUFuoafNMpDXKQKjzH9el/view?usp=sharing", pdfTitle: "Lesson: Everyday Superstitions" },
                { id: 'b1_4', title: "Modals of Deduction", category: "Modals", desc: "Must be.", examples: ["He must be."], tip: "Probability." },
                { id: 'b1_5', title: "Passive Voice", category: "Structure", desc: "Object focus.", examples: ["Was broken."], tip: "Why use it?", pdf: "https://drive.google.com/file/d/1ODXy1cMM4Mg11xnmjo-NwmVSRLr4WDbZ/view?usp=sharing", pdfTitle: "Lesson: Eurovision" },
                { id: 'b1_6', title: "Past Continuous", category: "Tenses", desc: "Interrupted.", examples: ["Was sleeping."], tip: "While/When." },
                { id: 'b1_7', title: "Used to", category: "Structure", desc: "Past habits.", examples: ["Used to go."], tip: "Not 'Be used to'.", pdf: "https://drive.google.com/file/d/1tOY5iH_NU-sRmAOOdWvTwcbzfx73IN6v/view?usp=sharing", pdfTitle: "Lesson: Journey of Life" },
                { id: 'b1_8', title: "Quantifiers", category: "Determiners", desc: "A few/little.", examples: ["A little."], tip: "Countable check." },
                { id: 'b1_9', title: "Relative Clauses", category: "Structure", desc: "Who/Which.", examples: ["Man who..."], tip: "Omission." },
                { id: 'b1_10', title: "Indefinite Pronouns", category: "Pronouns", desc: "Someone.", examples: ["Anyone."], tip: "Singular verb." }
            ]
        },
        'B2': {
            title: "Complexity",
            desc: "Nuance.",
            topics: [
                { id: 'b2_1', title: "Second Conditional", category: "Structure", desc: "Hypothetical.", examples: ["If I won..."], tip: "Imagination." },
                { id: 'b2_2', title: "Third Conditional", category: "Structure", desc: "Regrets.", examples: ["If I had..."], tip: "Pronunciation." },
                { id: 'b2_3', title: "Past Perfect", category: "Tenses", desc: "Past of past.", examples: ["Had left."], tip: "Timeline." },
                { id: 'b2_4', title: "Reported Speech", category: "Structure", desc: "He said that...", examples: ["Said he was."], tip: "Backshift." },
                { id: 'b2_5', title: "Future Continuous", category: "Tenses", desc: "Will be doing.", examples: ["Will be flying."], tip: "In progress." },
                { id: 'b2_6', title: "Passive (Adv)", category: "Structure", desc: "It is said...", examples: ["Must be done."], tip: "Formal." },
                { id: 'b2_7', title: "Gerunds/Infinitives", category: "Verbs", desc: "Enjoy doing.", examples: ["Want to."], tip: "Memorize." },
                { id: 'b2_8', title: "Articles (Adv)", category: "Nouns", desc: "Geography.", examples: ["The UK."], tip: "Exceptions." },
                { id: 'b2_9', title: "Non-Defining Rel. Clauses", category: "Structure", desc: "Commas.", examples: ["My mom, who..."], tip: "Commas." },
                { id: 'b2_10', title: "So/Such/Too", category: "Adverbs", desc: "Intensifiers.", examples: ["Such a good."], tip: "Word order." }
            ]
        },
        'C1': {
            title: "Advanced",
            desc: "Style.",
            topics: [
                { id: 'c1_1', title: "Mixed Conditionals", category: "Structure", desc: "Past cause, present result.", examples: ["If hadn't... wouldn't be."], tip: "Mix times." },
                { id: 'c1_2', title: "Inversion", category: "Structure", desc: "Never have I...", examples: ["Rarely do we."], tip: "Emphasis." },
                { id: 'c1_3', title: "Cleft Sentences", category: "Structure", desc: "It was John...", examples: ["What I need..."], tip: "Focus." },
                { id: 'c1_4', title: "Participle Clauses", category: "Structure", desc: "Walking down...", examples: ["Seen by..."], tip: "Subject." },
                { id: 'c1_5', title: "Subjunctive", category: "Structure", desc: "Suggest he go.", examples: ["Vital that..."], tip: "Base form." },
                { id: 'c1_6', title: "Phrasal Verbs", category: "Vocabulary", desc: "Complex.", examples: ["Come up with."], tip: "Context." },
                { id: 'c1_7', title: "Future in Past", category: "Tenses", desc: "Was going to.", examples: ["Meant to."], tip: "Failed plans." },
                { id: 'c1_8', title: "Wish / If only", category: "Structure", desc: "Regrets.", examples: ["Wish I were."], tip: "Tense shift." },
                { id: 'c1_9', title: "Verb Patterns", category: "Verbs", desc: "Advise to.", examples: ["Make do."], tip: "Let/Make." },
                { id: 'c1_10', title: "Gradable Adjectives", category: "Adjectives", desc: "Absolutely.", examples: ["Very vs Absolutely."], tip: "Collocations." }
            ]
        },
        'C2': {
            title: "Mastery",
            desc: "Total control.",
            topics: [
                { id: 'c2_1', title: "Ellipsis", category: "Structure", desc: "Omitting words.", examples: ["Hope so."], tip: "Naturalness." },
                { id: 'c2_2', title: "Nominalisation", category: "Style", desc: "Nouns from verbs.", examples: ["The removal..."], tip: "Academic." },
                { id: 'c2_3', title: "Hedging", category: "Style", desc: "Softening.", examples: ["It appears."], tip: "Politeness." },
                { id: 'c2_4', title: "Discourse Markers", category: "Structure", desc: "Linking.", examples: ["Albeit."], tip: "Flow." },
                { id: 'c2_5', title: "Inversion (Cond)", category: "Structure", desc: "Had I...", examples: ["Should you."], tip: "Formal." },
                { id: 'c2_6', title: "Fronting", category: "Structure", desc: "Position.", examples: ["Gone are..."], tip: "Drama." },
                { id: 'c2_7', title: "Subtle Modals", category: "Modals", desc: "Needn't have.", examples: ["Dare."], tip: "Nuance." },
                { id: 'c2_8', title: "Multi-word Verbs", category: "Vocabulary", desc: "Compounds.", examples: ["Breakdown."], tip: "Stress." },
                { id: 'c2_9', title: "Archaic Forms", category: "Style", desc: "Whom.", examples: ["Whereby."], tip: "Legal." },
                { id: 'c2_10', title: "Patterns of Comparison", category: "Adjectives", desc: "The more...", examples: ["The less..."], tip: "Balance." }
            ]
        }
    };

    const app = {
        currentLevel: 'A1',
        currentTopicData: null,
        charts: {},

        init: function() {
            this.loadLevel('A1');
            this.renderRoadmap();
        },

        showSection: function(id) {
            document.getElementById('view-curriculum').classList.add('hidden');
            document.getElementById('view-roadmap').classList.add('hidden');
            document.getElementById(`view-${id}`).classList.remove('hidden');
        },

        loadLevel: function(level) {
            this.currentLevel = level;
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–æ–≤
            document.querySelectorAll('nav button').forEach(b => {
                b.className = 'tab-inactive whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center';
            });
            document.getElementById(`tab-${level}`).className = 'tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm w-1/6 text-center';

            // –†–µ–Ω–¥–µ—Ä –∫–æ–Ω—Ç–µ–Ω—Ç–∞
            const data = grammarData[level];
            const div = document.getElementById('level-content');
            div.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2">
                        <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200">
                            <h2 class="text-2xl font-bold text-slate-800 mb-2">${level}: ${data.title}</h2>
                            <p class="text-slate-600 mb-6">${data.desc}</p>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${data.topics.map((t, i) => `
                                    <div onclick="app.openModal('${level}', ${i})" class="topic-card bg-white p-4 rounded border border-stone-200 cursor-pointer group">
                                        <div class="flex justify-between items-start mb-2">
                                            <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-0.5 rounded">${t.category}</span>
                                            ${t.pdf ? '<span class="text-xs text-amber-600 font-bold bg-amber-50 px-1 rounded">PDF</span>' : ''}
                                        </div>
                                        <h4 class="font-bold text-slate-800 group-hover:text-blue-700">${t.title}</h4>
                                        <p class="text-sm text-slate-500 truncate">${t.desc}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-1">
                         <div class="bg-white p-6 rounded-lg shadow-sm border border-stone-200 mb-4">
                            <h3 class="font-bold text-slate-700 mb-4 text-center">Focus</h3>
                            <div class="chart-container" style="height:200px"><canvas id="levelChart"></canvas></div>
                         </div>
                    </div>
                </div>
            `;
            setTimeout(() => this.renderLevelChart(level), 100);
        },

        openModal: function(level, index) {
            const t = grammarData[level].topics[index];
            this.currentTopicData = t;

            document.getElementById('modal-title').innerText = t.title;
            document.getElementById('modal-category').innerText = t.category;
            document.getElementById('modal-desc').innerText = t.desc;
            document.getElementById('modal-tip').innerText = t.tip;
            document.getElementById('modal-examples').innerHTML = t.examples.map(e => `<li>${e}</li>`).join('');

            // PDF
            const btn = document.getElementById('pdf-link-btn');
            const missing = document.getElementById('pdf-missing-badge');
            if(t.pdf) {
                btn.href = t.pdf;
                btn.classList.remove('hidden');
                missing.classList.add('hidden');
                document.getElementById('pdf-status-text').innerText = t.pdfTitle || "PDF Available";
            } else {
                btn.classList.add('hidden');
                missing.classList.remove('hidden');
                document.getElementById('pdf-status-text').innerText = "No PDF";
            }

            // –°–±—Ä–æ—Å AI
            document.getElementById('ai-output').classList.add('hidden');
            document.getElementById('ai-error').classList.add('hidden');
            document.getElementById('btn-lesson-plan').disabled = false;
            document.getElementById('btn-examples').disabled = false;

            document.getElementById('topic-modal').classList.remove('hidden');
        },

        closeModal: function() {
            document.getElementById('topic-modal').classList.add('hidden');
        },

        setAiLoading: function(loading, msg) {
            const div = document.getElementById('ai-output');
            const load = document.getElementById('ai-loading');
            const box = document.getElementById('ai-content-box');
            const err = document.getElementById('ai-error');

            div.classList.remove('hidden');
            if(loading) {
                load.classList.remove('hidden');
                document.getElementById('ai-loading-text').innerText = msg;
                box.classList.add('hidden');
                err.classList.add('hidden');
            } else {
                load.classList.add('hidden');
            }
            document.getElementById('btn-lesson-plan').disabled = loading;
            document.getElementById('btn-examples').disabled = loading;
        },

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–õ–ê–ù–ê (–ü–†–û–°–¢–û–ô –¢–ï–ö–°–¢) ---
        generateLessonPlan: async function() {
            if (!this.currentTopicData) return;
            this.setAiLoading(true, "–ü–∏—à—É –ø–ª–∞–Ω —É—Ä–æ–∫–∞...");

            // –ü–†–û–°–¢–û–ô –ü–†–û–ú–ü–¢ –î–õ–Ø –¢–ï–ö–°–¢–ê
            const prompt = `Create a simple text lesson plan for "${this.currentTopicData.title}" (${this.currentLevel}).
            Structure: 1. Warm-up, 2. Presentation, 3. Practice, 4. Production.
            Do NOT use Markdown tables. Do NOT use HTML tags. Just use plain text with bullet points.`;

            try {
                const text = await callGemini(prompt, "You are an English Teacher.");
                // –í—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç, –ø—Ä–µ–≤—Ä–∞—â–∞—è –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –≤ <br>
                document.getElementById('ai-content').innerHTML = formatSimpleText(text);
                document.getElementById('ai-content-box').classList.remove('hidden');
            } catch (e) {
                document.getElementById('ai-error').innerText = e.message;
                document.getElementById('ai-error').classList.remove('hidden');
            } finally {
                this.setAiLoading(false);
            }
        },

        // --- –ì–ï–ù–ï–†–ê–¶–ò–Ø –ü–†–ò–ú–ï–†–û–í (–ü–†–û–°–¢–û–ô –¢–ï–ö–°–¢) ---
        generateMoreExamples: async function() {
            if (!this.currentTopicData) return;
            this.setAiLoading(true, "–ü—Ä–∏–¥—É–º—ã–≤–∞—é –ø—Ä–∏–º–µ—Ä—ã...");

            const prompt = `Write 10 simple example sentences for "${this.currentTopicData.title}" (${this.currentLevel}).
            Just a numbered list. No extra text.`;

            try {
                const text = await callGemini(prompt, "You are a teacher.");
                document.getElementById('ai-content').innerHTML = "<h3>‚ú® New Examples:</h3><br>" + formatSimpleText(text);
                document.getElementById('ai-content-box').classList.remove('hidden');
            } catch (e) {
                document.getElementById('ai-error').innerText = e.message;
                document.getElementById('ai-error').classList.remove('hidden');
            } finally {
                this.setAiLoading(false);
            }
        },

        renderLevelChart: function(level) {
            // –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä –≥—Ä–∞—Ñ–∏–∫–∞ —á—Ç–æ–±—ã –Ω–µ –∑–∞–Ω–∏–º–∞—Ç—å –º–µ—Å—Ç–æ
            const ctx = document.getElementById('levelChart').getContext('2d');
            if (this.charts.level) this.charts.level.destroy();

            // –°—á–∏—Ç–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const cats = {};
            grammarData[level].topics.forEach(t => cats[t.category] = (cats[t.category]||0)+1);

            this.charts.level = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(cats),
                    datasets: [{ data: Object.values(cats), backgroundColor: ['#94a3b8','#64748b','#cbd5e1','#475569'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        },

        renderRoadmap: function() {
            const ctx = document.getElementById('roadmapChart').getContext('2d');
            this.charts.roadmap = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Start', 'A1', 'A2', 'B1', 'B2', 'C1', 'C2'],
                    datasets: [{
                        label: 'Difficulty',
                        data: [0, 15, 30, 50, 75, 90, 100],
                        borderColor: '#475569',
                        tension: 0.3,
                        fill: false
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }
    };

    document.addEventListener('DOMContentLoaded', () => app.init());
</script>
</body>
</html>